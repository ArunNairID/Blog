<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>From Neutrinos to Data Science</title>


        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="webscraping" />
        <meta name="tags" contents="BeautifulSoup" />


			<meta property="og:locale" content="en">
		<meta property="og:site_name" content="From Neutrinos to Data Science">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="/web-scraping-chess-games.html">
	<meta property="og:title" content="Web Scraping to Create a Custom Chess Games Database">
	<meta property="og:description" content="Scraping an Online Chess Games Database; Paywalls are for the Weak!">
	<meta property="og:image" content="/">
	<meta property="article:published_time" content="2015-12-17 00:00:00-06:00">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
		<a class="navbar-brand" href="/"> Blog Home </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://davidkaleko.com">davidkaleko.com</a></li>
		<!--
-->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Web Scraping to Create a Custom Chess Games Database</h1>
                            <h3 class="subheading">Scraping an Online Chess Games Database; Paywalls are for the Weak!</h3>
                        <span class="meta">Posted by
                                <a href="http://davidkaleko.com/#about">David Kaleko</a>
                             on Thu 17 December 2015
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <style type="text/css">/*!
*
* IPython notebook
*
*/.ansibold{font-weight:700}.ansiblack{}.ansired{color:#8b0000}.ansigreen{6400}.ansiyellow{color:#c4a000}.ansiblue{8b}.ansipurple{color:#9400d3}.ansicyan{color:#4682b4}.ansigray{color:gray}.ansibgblack{background-}.ansibgred{background-color:red}.ansibggreen{background-color:green}.ansibgyellow{background-color:#ff0}.ansibgblue{background-f}.ansibgpurple{background-color:#ff00ff}.ansibgcyan{background-ff}.ansibggray{background-color:gray}div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;border-radius:2px;box-sizing:border-box;-moz-box-sizing:border-box;border-width:thin;border-style:solid;width:100%;padding:5px;margin:0;outline:0}div.cell.selected{border-color:#ababab}@media print{div.cell.selected{border-color:transparent}}.edit_mode div.cell.selected{border-color:green}.prompt{min-width:14ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}@-moz-document url-prefix(){div.inner_cell{overflow-x:hidden}}div.input_area{border:1px solid #cfcfcf;border-radius:2px;background:#f7f7f7;line-height:1.21429em}div.prompt:empty{padding-top:0;padding-bottom:0}div.unrecognized_cell{padding:5px 5px 5px 0;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.unrecognized_cell .inner_cell{border-radius:2px;padding:5px;font-weight:700;color:red;border:1px solid #cfcfcf;background:#eaeaea}div.unrecognized_cell .inner_cell a,div.unrecognized_cell .inner_cell a:hover{color:inherit;text-decoration:none}@media (max-width:540px){.prompt{text-align:left}div.unrecognized_cell>div.prompt{display:none}}div.code_cell{}div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.input{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.input_prompt{color:navy;border-top:1px solid transparent}div.input_area>div.highlight{margin:.4em;border:none;padding:0;background-color:transparent}div.input_area>div.highlight>pre{margin:0;border:none;padding:0;background-color:transparent}.CodeMirror{line-height:1.21429em;font-size:14px;height:auto;background:0 0}.CodeMirror-scroll{overflow-y:hidden;overflow-x:auto}.CodeMirror-lines{padding:.4em}.CodeMirror-linenumber{padding:0 8px 0 4px}.CodeMirror-gutters{border-bottom-left-radius:2px;border-top-left-radius:2px}.CodeMirror pre{padding:0;border:0;border-radius:0}.highlight-base,.highlight-variable{}.highlight-variable-2{color:#1a1a1a}.highlight-variable-3{color:#333}.highlight-string{color:#BA2121}.highlight-comment{color:#408080;font-style:italic}.highlight-number{80}.highlight-atom{color:#88F}.highlight-keyword{color:green;font-weight:700}.highlight-builtin{color:green}.highlight-error{color:red}.highlight-operator{color:#A2F;font-weight:700}.highlight-meta{color:#A2F}.highlight-def{f}.highlight-string-2{color:#f50}.highlight-qualifier{color:#555}.highlight-bracket{color:#997}.highlight-tag{color:#170}.highlight-attribute{c}.highlight-header{f}.highlight-quote{90}.highlight-link{c}.cm-s-ipython span.cm-keyword{color:green;font-weight:700}.cm-s-ipython span.cm-atom{color:#88F}.cm-s-ipython span.cm-number{80}.cm-s-ipython span.cm-def{f}.cm-s-ipython span.cm-variable{}.cm-s-ipython span.cm-operator{color:#A2F;font-weight:700}.cm-s-ipython span.cm-variable-2{color:#1a1a1a}.cm-s-ipython span.cm-variable-3{color:#333}.cm-s-ipython span.cm-comment{color:#408080;font-style:italic}.cm-s-ipython span.cm-string{color:#BA2121}.cm-s-ipython span.cm-string-2{color:#f50}.cm-s-ipython span.cm-meta{color:#A2F}.cm-s-ipython span.cm-qualifier{color:#555}.cm-s-ipython span.cm-builtin{color:green}.cm-s-ipython span.cm-bracket{color:#997}.cm-s-ipython span.cm-tag{color:#170}.cm-s-ipython span.cm-attribute{c}.cm-s-ipython span.cm-header{f}.cm-s-ipython span.cm-quote{90}.cm-s-ipython span.cm-link{c}.cm-s-ipython span.cm-error{color:red}.cm-s-ipython span.cm-tab{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=')right no-repeat}div.output_wrapper{display:-webkit-box;-webkit-box-align:stretch;display:-moz-box;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;z-index:1}div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:2px;-webkit-box-shadow:inset 0 2px 8px rgba(0,0,0,.8);box-shadow:inset 0 2px 8px rgba(0,0,0,.8);display:block}div.output_collapsed{margin:0;padding:0;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.out_prompt_overlay{height:100%;padding:0 .4em;position:absolute;border-radius:2px}div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000;box-shadow:inset 0 0 1px #000;background:rgba(240,240,240,.5)}div.output_prompt{color:#8b0000}div.output_area{padding:0;page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.output_area .MathJax_Display{text-align:left!important}div.output_area div.output_area img,div.output_area svg{max-width:100%;height:auto}div.output_area img.unconfined,div.output_area svg.unconfined{max-width:none}.output{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}@media (max-width:540px){div.output_area{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.output_area pre{margin:0;padding:0;border:0;vertical-align:baseline;background-color:transparent;border-radius:0}div.output_subarea{overflow-x:auto;padding:.4em;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1;max-width:calc(100% - 14ex)}div.output_text{text-align:left;line-height:1.21429em}div.output_stderr{background:#fdd}div.output_latex{text-align:left}div.output_javascript:empty{padding:0}.js-error{color:#8b0000}div.raw_input_container{font-family:monospace;padding-top:5px}span.raw_input_prompt{}input.raw_input{font-family:inherit;font-size:inherit;color:inherit;width:auto;vertical-align:baseline;padding:0 .25em;margin:0 .25em}input.raw_input:focus{box-shadow:none}p.p-space{margin-bottom:10px}div.output_unrecognized{padding:5px;font-weight:700;color:red}div.output_unrecognized a,div.output_unrecognized a:hover{color:inherit;text-decoration:none}.rendered_html{}.rendered_html :link,.rendered_html :visited,.rendered_html h1:first-child{margin-top:.538em}.rendered_html h2:first-child{margin-top:.636em}.rendered_html h3:first-child{margin-top:.777em}.rendered_html h4:first-child,.rendered_html h5:first-child,.rendered_html h6:first-child{margin-top:1em}.rendered_html *+ol,.rendered_html *+ul{margin-top:1em}.rendered_html *+table{margin-top:1em}.rendered_html *+p{margin-top:1em}.rendered_html *+img{margin-top:1em}div.text_cell{display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.text_cell>div.prompt{display:none}}div.text_cell_render{outline:0;resize:none;width:inherit;border-style:none;padding:.5em .5em .5em .4em;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}a.anchor-link:link{text-decoration:none;padding:0 20px;visibility:hidden}h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible}.text_cell.rendered .input_area{display:none}.text_cell.rendered .text_cell.unrendered .text_cell_render{display:none}.cm-header-1,.cm-header-2,.cm-header-3,.cm-header-4,.cm-header-5,.cm-header-6{font-weight:700;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}.cm-header-1{font-size:185.7%}.cm-header-2{font-size:157.1%}.cm-header-3{font-size:128.6%}.cm-header-4{font-size:110%}.cm-header-5,.cm-header-6{font-size:100%;font-style:italic}</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-BeautifulSoup-to-Scrape-a-Paid-Online-Chess-Database-for-Free">Using BeautifulSoup to Scrape a Paid Online Chess Database for Free<a class="anchor-link" href="#Using-BeautifulSoup-to-Scrape-a-Paid-Online-Chess-Database-for-Free">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Disclaimer:-I'm-a-fan-of-paying-for-content-that-you-enjoy,-but-in-this-case,-I-would-like-to-avoid-paying-a-yearly-membership-for-one-simple-query-that-I'm-trying-to-do.">Disclaimer: I'm a fan of paying for content that you enjoy, but in this case, I would like to avoid paying a yearly membership for one simple query that I'm trying to do.<a class="anchor-link" href="#Disclaimer:-I'm-a-fan-of-paying-for-content-that-you-enjoy,-but-in-this-case,-I-would-like-to-avoid-paying-a-yearly-membership-for-one-simple-query-that-I'm-trying-to-do.">¶</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, I have a chess match in a few hours. I'm playing as Black, and I happen to know what kind of opening moves my opponent generally plays (1. d4). I'm hoping to do some preparation for the game by grabbing a list of chess games played by grandmasters that follow similar opening moves. Specifically, chess games are recorded in <a href="https://en.wikipedia.org/wiki/Portable_Game_Notation">PGN notation</a>, so I want to save a bunch of pgns to a text file that I can open with a chess program to allow me to play out the games and study lines in the opening. Unfortunately, <a href="http://www.chessgames.com">the website I'm trying to query</a> for such a custom database is asking me to sign up as a paid member for this.</p>
<p>The website allows you to look at individual games for free, and even to search for a list of games based on specific conditions (for example, which opening was played), but it won't allow you to batch-download the games into a custom database without passing a paywall. Therefore, I'm going to write a quick script to pull down the grandmaster games from their website individually and save them to my own database (a .pgn text file, in this case).</p>
<p><a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">Beautiful Soup</a> is a python library for pulling data out of HTML and XML files. I've only recently started using it and it seems like a very powerful tool.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I found the base url below by going to the main chess database site and entering a basic query: I want games following the opening known as the "<a href="https://en.wikipedia.org/wiki/Benko_Gambit">Benko Gambit</a>" (which I am hoping to play tonight), and the games have to be played after the year 2010. I add the year requirement because chess opening theory is constantly evolving so specific lines in the opening before this year may be outdated (generally meaning they've been refuted by computers).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="n">maxgames</span> <span class="o">=</span> <span class="mi">50</span> <span class="c">#I won't have time to look through tons of games, </span>
              <span class="c">#so let's only save 50</span>
<span class="k">def</span> <span class="nf">getSoup</span><span class="p">(</span><span class="n">pagenum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c">#Split the url into two lines just to make it easier to see</span>
    <span class="n">baseurl</span> <span class="o">=</span> <span class="s">'http://www.chessgames.com/perl/chess.pl?page=</span><span class="si">%d</span><span class="s">&amp;'</span><span class="o">%</span> <span class="n">pagenum</span>
    <span class="n">baseurl</span> <span class="o">+=</span> <span class="s">'playercomp=either&amp;year=2010&amp;yearcomp=ge&amp;eco=A57-A59'</span> 
    <span class="n">ufile</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">ufile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="n">soup</span> <span class="o">=</span> <span class="n">getSoup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now I have the HTML from the first page (which contains a table of 25 games, each of which is a hyperlink) in the form of a BeautifulSoup instance. The page also contains a string like "page 1 of 10", meaning I can sift through more than just the first page if I want to extract more than 25 games. Here's how I determine the maximum number of pages I can loop through:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="c">#Let's split up the page's text, look for a specific string</span>
<span class="c">#There happen to be multiple instances on each page, </span>
<span class="c">#so let's just use sets to identify unique elements.</span>
<span class="n">pagenumstr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">)</span> <span class="k">if</span> <span class="s">'page '</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">npages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pagenumstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span> <span class="s">"There are </span><span class="si">%d</span><span class="s"> maximum pages to sift through."</span> <span class="o">%</span> <span class="n">npages</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>There are 46 maximum pages to sift through.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I can use some of the basic BeautifulSoup utilities to keep only the hyperlinks, and furthermore, keep only the ones that point to actual chess games (there are other hyperlinks that point to various other places). I will identify the relevant links by requiring they contain a specific string within them.</p>
<p>The function below will extract and build a list of URLs (as strings) that point to individual chess games. Later, I'll loop through these URLs and extract what I want (the PGN) from each of these URLs</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="c">#Note I'm using an older version of BeautifulSoup, so I use </span>
<span class="c"># findAll instead of find_all</span>
<span class="c">#Pull out all the links in the soup (they start with &lt;a href= ...)</span>
<span class="k">def</span> <span class="nf">getAbsoluteURLs</span><span class="p">(</span><span class="n">mysoup</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Given a soup object, do some munging and return me the list of URLs that</span>
<span class="sd">    point to pages containing PGNs of individual games</span>
<span class="sd">    """</span>
    <span class="c">#all_links is a list of type 'BeautifulSoup.Tag'</span>
    <span class="n">all_links</span> <span class="o">=</span> <span class="n">mysoup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
    
    <span class="c">#From all_links, extract the ones that link directly to an actual game</span>
    <span class="c">#and store the unicode that can be used to build a full URL that game</span>
    <span class="n">rel_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'href'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_links</span> <span class="k">if</span> <span class="s">'/perl/chessgame?gid='</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'href'</span><span class="p">)]</span>
    <span class="c">#An element in rel_link looks like: /perl/chessgame?gid=1805362</span>
    
    <span class="c">#I notice that when I acutally click on the link, it takes me to </span>
    <span class="c">#the following url: http://www.chessgames.com/perl/chessgame?gid=1000223. </span>
    <span class="c">#That's amazingly convenient... </span>
    <span class="c">#let's build a list of full URLs, each of which </span>
    <span class="c">#points to an individual game.</span>
    <span class="n">abs_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">'http://www.chessgames.com'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rel_links</span><span class="p">]</span>
    <span class="c">#An element in abs_urls looks like: </span>
    <span class="c"># "http://www.chessgames.com/perl/chessgame?gid=1805362"</span>
    
    <span class="k">return</span> <span class="n">abs_urls</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I see the HTML of each game page contains the PGN I'm after, always surrounded by a block like</p>
<p><code>&lt;textarea style="display: none;" id="pgnText"&gt;</code></p>
<p>so I'll find that in each of the soups and scrape out the PGN! Additionally, the PGN contains the playing strength of the Black player, and I'd like to make a cut on that to ensure I'm only looking at games from the strongest players.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="k">def</span> <span class="nf">scrapePGN</span><span class="p">(</span><span class="n">myurl</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Function that, given a URL to a specific chess game, extracts the PGN and</span>
<span class="sd">    returns it as a string.</span>
<span class="sd">    """</span>
    <span class="n">mysoup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">myurl</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mysoup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'textarea'</span><span class="p">)</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">verifyPGN</span><span class="p">(</span><span class="n">pgnstring</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    I want to make sure that the player using the Black pieces </span>
<span class="sd">    (as I will be tonight) is very strong. Chess players have </span>
<span class="sd">    a "rating", and I'll make sure the Black player is rated </span>
<span class="sd">    at least 2200 if I'm going to save this game.</span>
<span class="sd">    """</span>
    <span class="n">min_allowable_ELO</span> <span class="o">=</span> <span class="mi">2200</span>
    
    <span class="k">if</span> <span class="s">'BlackElo'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pgnstring</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">elostr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pgnstring</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"["</span><span class="p">)</span> <span class="k">if</span> <span class="s">'BlackElo'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#Sometimes BlackELO is unknown... skip those games!</span>
        <span class="k">if</span> <span class="s">"?"</span> <span class="ow">in</span> <span class="n">elostr</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">elostr</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">"BlackElo"</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_allowable_ELO</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I also notice that the games are reverse-time-ordered... meaning, the most recent games are on the last page. I'd like to view them starting with the most recent, so let's start by grabbing some links on the back page, and loop in reverse.</p>
<p>Below is the main function that does all of the looping, scraping, munging, etc. The final output is a list of PGN strings, which I will write to a file.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="k">def</span> <span class="nf">genPGNs</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Main function: Loops through the table pages in reverse order, </span>
<span class="sd">    generates a list of links from each page, goes to each of those</span>
<span class="sd">    links, and extracts the PGN. It continues looping until it has </span>
<span class="sd">    scraped "maxgames" PGNs, then stops and returns a list of the </span>
<span class="sd">    PGNs (again, stored as strings).</span>
<span class="sd">    """</span>
    <span class="n">pgns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_games_scraped</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ipage</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">npages</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">getSoup</span><span class="p">(</span><span class="n">ipage</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">getAbsoluteURLs</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
            <span class="n">pgn</span> <span class="o">=</span> <span class="n">scrapePGN</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyPGN</span><span class="p">(</span><span class="n">pgn</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">pgns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgn</span><span class="p">)</span>
            <span class="n">n_games_scraped</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">n_games_scraped</span> <span class="o">&gt;=</span> <span class="n">maxgames</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">"Done! Scraped </span><span class="si">%d</span><span class="s"> games."</span> <span class="o">%</span> <span class="n">n_games_scraped</span>
                <span class="k">return</span> <span class="n">pgns</span>
    <span class="k">print</span> <span class="s">"Done! Didn't reach maximum number of games. Scraped </span><span class="si">%d</span><span class="s"> games."</span> <span class="o">%</span> <span class="n">n_games_scraped</span>
    <span class="k">return</span> <span class="n">pgns</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="n">pgns</span> <span class="o">=</span> <span class="n">genPGNs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Done! Scraped 50 games.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now to create an output file! <a href="http://scidvspc.sourceforge.net/">My chess program</a> fortunately just reads in a plain text file with a bunch of pgns copied and pasted, so making the output file should be a cinch.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="n">outfile</span> <span class="o">=</span> <span class="s">'benko_games_db.pgn'</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pgn</span> <span class="ow">in</span> <span class="n">pgns</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pgn</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's have a quick look to make sure everything was saved alright in my output file:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="o">!</span>head  -n <span class="m">25</span> <span class="nv">$outfile</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[Event "British Championships"]
[Site "Coventry ENG"]
[Date "2015.08.07"]
[EventDate "2015.07.27"]
[Round "11.36"]
[Result "1/2-1/2"]
[White "Michael Ashworth"]
[Black "John Garnett"]
[ECO "A59"]
[WhiteElo "1912"]
[BlackElo "1984"]
[PlyCount "82"]

1. d4 Nf6 2. c4 c5 3. d5 b5 4. cxb5 a6 5. bxa6 g6 6. Nc3 Bxa6
7. e4 Bxf1 8. Kxf1 d6 9. g3 Bg7 10. Kg2 O-O 11. Nf3 Na6
12. Qe2 Qb6 13. Nd2 Nc7 14. Nc4 Qa6 15. a4 Rfb8 16. Bd2 Nd7
17. Rhe1 Nb6 18. Nxb6 Qxb6 19. Reb1 e6 20. Qd3 exd5 21. Nxd5
Nxd5 22. Qxd5 Qb7 23. Qd3 Qc6 24. Qc2 Re8 25. Re1 d5 26. exd5
Qxd5+ 27. f3 Bd4 28. Rxe8+ Rxe8 29. Re1 Rb8 30. Bc3 Qc4
31. Re2 Bxc3 32. bxc3 Rb3 33. Re4 Qxc3 34. Qxc3 Rxc3 35. Re8+
Kg7 36. a5 Rc2+ 37. Kh3 Ra2 38. Ra8 c4 39. a6 c3 40. a7 c2
41. Rc8 Rxa7 1/2-1/2

[Event "PokerStars IoM Masters"]
[Site "Douglas ENG"]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hooray! I've successfully created my output PGN file. I'm going to go load it into my chess program and start studying for my game tonight. Wish me luck!</p>
</div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

    </article>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <!--<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">-->
		<div class="col-lg-8 col-md-10">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="http://twitter.com/davidkaleko">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="http://facebook.com/davidkaleko">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="http://github.com/kaleko">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Blog powered by <a href="http://getpelican.com">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>